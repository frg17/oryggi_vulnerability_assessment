#!/bin/sh


read_file () # Fetch subnets to scan from file
{
	if [ -n "$1" ]; then
		SUBNETS=`cat $1`
		perform_scan "$SUBNETS"
	else
		echo "No filename supplied."
	fi
}

perform_scan ()
{
	if [ ! -d "host_scans" ]; then
		mkdir host_scans
	fi
	
	SCANCOUNT=0
	for SUBNET in $1
	do
		SCANCOUNT=`expr $SCANCOUNT + 1`
		SAVEPATH="host_scans/subnet_${SCANCOUNT}"

		echo "-------- Scanning ${SUBNET} --------"
		echo "$SUBNET" > "$SAVEPATH"
		nmap -sP $SUBNET | #Get all hosts that are up \
		grep -P -w "\((\d{1,3}\.){3}\d{1,3}\)" | #Filter lines containing up hosts \
		cut -d" "  -f5,6 | # Get hostname and ip \
		sed "s/[\(\)]//g" >> "$SAVEPATH"  # Clear braces

	done

	echo "Performed ${SCANCOUNT} scans."
	echo "Results stored in ./host_scans/"

}


case $1 in
	-f)
		read_file $2
		;;
	-h)
		echo --------------------------------
		echo "Options:"
		echo "###.###.###.###	:Default"
		echo "-f <filename>	:File includes subnets to scan"
		echo --------------------------------
		;;
	*)
		if [ -n "$1" ]; then
			perform_scan $1
		else
			echo "No subnet supplied"
		fi
		;;
esac	
		

