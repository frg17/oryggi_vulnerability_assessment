
if [ $# -lt 1 ]; then
	echo "Missing parameter <Directory name>"
	exit 0
fi

if [ ! -d $1 ]; then
	echo "Passed parameter needs to be a directory"
	exit 0
fi

# Create directory to store results.
DIR_LOCATION="nmap-vulners_scans"
if [ ! -d $DIR_LOCATION ]; then
	mkdir $DIR_LOCATION
fi


for FILE in ${1}/*; do # For each file in directory
	IP=`basename $FILE` # Extract IP name
	echo "- IP - ${IP}"
	# Get the open ports for IP, then seperate them by commas, and pass to nmap scan.
	nmap --script nmap-vulners -sV -p`grep -oP "^\d{1,5}" $FILE | paste -d, -s` $IP \
	> "${DIR_LOCATION}/${IP}" #Save result in file 
done


