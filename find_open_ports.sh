# Scan ALL supplied IPS for open ports
scan_for_ports () {
	if [ ! -d port_scans ]; then
		mkdir port_scans
	fi
	
	for IP in $1; do
		echo $IP
		SAVEPATH="port_scans/${IP}"
		nmap -sS $IP |
		grep -P "\d{1,5}/" > "$SAVEPATH"
	done
}



if [ ! -d $1 ]; then 		#Check if file exists
	echo "No directory supplied"
	exit 0
fi

for f in ${1}/*; do

	read -r SUBNET < $f

	if [ ! -n "$SUBNET" ]; then #Check if file is valid
		echo "${f} Invalid."
		exit 1
	fi

	IPS=`cut -s -d" " -f2 $f`	#Get IPS
	scan_for_ports "$IPS"		#Scan all ips for open ports
done
